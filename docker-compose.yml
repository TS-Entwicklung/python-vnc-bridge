services:
  python-vnc-bridge:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: python-vnc-game
    restart: unless-stopped

    # Volume mount - EDIT THIS PATH to your Python game directory
    volumes:
      - ./app:/app  # Change './app' to your game directory path

    # Environment variables - set these in Portainer Stack or docker-compose
    environment:
      - VNC_PASSWORD=${VNC_PASSWORD:-}  # Optional: Leave empty for no password
      - VNC_PORT=${VNC_PORT:-5900}
      - NOVNC_PORT=${NOVNC_PORT:-6080}
      - DISPLAY_WIDTH=${DISPLAY_WIDTH:-800}
      - DISPLAY_HEIGHT=${DISPLAY_HEIGHT:-600}
      - VNC_FPS=${VNC_FPS:-15}
      - ENABLE_AUDIO=${ENABLE_AUDIO:-false}
      - VNC_COLOR_DEPTH=${VNC_COLOR_DEPTH:-16}

    # Port mapping
    ports:
      - "${NOVNC_PORT:-6080}:${NOVNC_PORT:-6080}"  # noVNC web interface
      - "${VNC_PORT:-5900}:${VNC_PORT:-5900}"      # VNC direct connection

    # Security
    security_opt:
      - seccomp:unconfined

    # Performance tuning for ARM64
    shm_size: '256mb'

    # Optional: Resource limits for BananaPi
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2.0'
    #       memory: 1G
    #     reservations:
    #       memory: 512M
