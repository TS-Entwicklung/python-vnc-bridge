services:
  python-vnc-bridge:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: python-vnc-game
    restart: unless-stopped

    # Volume mount - OPTIONAL if using GIT_REPO
    # Comment out if you use GIT_REPO to clone from Git
    volumes:
      - ./app:/app  # Change './app' to your game directory path

    # Environment variables - set these in Portainer Stack or docker-compose
    environment:
      # Debug mode
      - DEBUG=${DEBUG:-true}  # Set to 'false' to disable detailed logging

      # VNC Configuration
      - VNC_PASSWORD=${VNC_PASSWORD:-}  # Optional: Leave empty for no password
      - VNC_PORT=${VNC_PORT:-5900}
      - NOVNC_PORT=${NOVNC_PORT:-6080}
      - DISPLAY_WIDTH=${DISPLAY_WIDTH:-800}
      - DISPLAY_HEIGHT=${DISPLAY_HEIGHT:-600}
      - VNC_FPS=${VNC_FPS:-15}
      - ENABLE_AUDIO=${ENABLE_AUDIO:-false}
      - VNC_COLOR_DEPTH=${VNC_COLOR_DEPTH:-16}
      - START_PYTHON_APP=${START_PYTHON_APP:-true}  # Auto-start Python app in desktop

      # Git Clone Configuration (Alternative to volume mount)
      # Uncomment and configure to clone from Git repository
      # - GIT_REPO=https://github.com/username/repo.git
      # - GIT_BRANCH=${GIT_BRANCH:-main}  # Optional: default is 'main'
      # - GIT_USERNAME=${GIT_USERNAME:-}  # Optional: for private repos
      # - GIT_TOKEN=${GIT_TOKEN:-}        # Optional: GitHub Personal Access Token

    # Port mapping
    ports:
      - "${NOVNC_PORT:-6080}:${NOVNC_PORT:-6080}"  # noVNC web interface
      - "${VNC_PORT:-5900}:${VNC_PORT:-5900}"      # VNC direct connection

    # Security
    security_opt:
      - seccomp:unconfined

    # Performance tuning for ARM64
    shm_size: '256mb'

    # Optional: Resource limits for BananaPi
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2.0'
    #       memory: 1G
    #     reservations:
    #       memory: 512M
